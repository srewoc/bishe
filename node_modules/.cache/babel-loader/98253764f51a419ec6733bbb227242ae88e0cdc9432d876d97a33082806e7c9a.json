{"ast":null,"code":"import { defineComponent, markRaw, ref, effectScope, shallowRef, computed, watch, nextTick, onMounted, openBlock, createBlock, unref, withCtx, createVNode, Transition, createElementVNode, normalizeClass, normalizeStyle, withModifiers, createCommentVNode, createElementBlock, Fragment, renderSlot, createTextVNode, toDisplayString, resolveDynamicComponent, renderList, withDirectives, vShow } from 'vue';\nimport { useEventListener } from '@vueuse/core';\nimport { throttle } from 'lodash-unified';\nimport ElFocusTrap from '../../focus-trap/src/focus-trap.mjs';\nimport { ElTeleport } from '../../teleport/index.mjs';\nimport { ElIcon } from '../../icon/index.mjs';\nimport { FullScreen, ScaleToOriginal, Close, ArrowLeft, ArrowRight, ZoomOut, ZoomIn, RefreshLeft, RefreshRight } from '@element-plus/icons-vue';\nimport { imageViewerProps, imageViewerEmits } from './image-viewer.mjs';\nimport _export_sfc from '../../../_virtual/plugin-vue_export-helper.mjs';\nimport { useLocale } from '../../../hooks/use-locale/index.mjs';\nimport { useNamespace } from '../../../hooks/use-namespace/index.mjs';\nimport { useZIndex } from '../../../hooks/use-z-index/index.mjs';\nimport { EVENT_CODE } from '../../../constants/aria.mjs';\nimport { keysOf } from '../../../utils/objects.mjs';\nconst __default__ = defineComponent({\n  name: \"ElImageViewer\"\n});\nconst _sfc_main = /* @__PURE__ */defineComponent({\n  ...__default__,\n  props: imageViewerProps,\n  emits: imageViewerEmits,\n  setup(__props, {\n    expose,\n    emit\n  }) {\n    var _a;\n    const props = __props;\n    const modes = {\n      CONTAIN: {\n        name: \"contain\",\n        icon: markRaw(FullScreen)\n      },\n      ORIGINAL: {\n        name: \"original\",\n        icon: markRaw(ScaleToOriginal)\n      }\n    };\n    const {\n      t\n    } = useLocale();\n    const ns = useNamespace(\"image-viewer\");\n    const {\n      nextZIndex\n    } = useZIndex();\n    const wrapper = ref();\n    const imgRefs = ref([]);\n    const scopeEventListener = effectScope();\n    const loading = ref(true);\n    const activeIndex = ref(props.initialIndex);\n    const mode = shallowRef(modes.CONTAIN);\n    const transform = ref({\n      scale: 1,\n      deg: 0,\n      offsetX: 0,\n      offsetY: 0,\n      enableTransition: false\n    });\n    const zIndex = ref((_a = props.zIndex) != null ? _a : nextZIndex());\n    const isSingle = computed(() => {\n      const {\n        urlList\n      } = props;\n      return urlList.length <= 1;\n    });\n    const isFirst = computed(() => activeIndex.value === 0);\n    const isLast = computed(() => activeIndex.value === props.urlList.length - 1);\n    const currentImg = computed(() => props.urlList[activeIndex.value]);\n    const arrowPrevKls = computed(() => [ns.e(\"btn\"), ns.e(\"prev\"), ns.is(\"disabled\", !props.infinite && isFirst.value)]);\n    const arrowNextKls = computed(() => [ns.e(\"btn\"), ns.e(\"next\"), ns.is(\"disabled\", !props.infinite && isLast.value)]);\n    const imgStyle = computed(() => {\n      const {\n        scale,\n        deg,\n        offsetX,\n        offsetY,\n        enableTransition\n      } = transform.value;\n      let translateX = offsetX / scale;\n      let translateY = offsetY / scale;\n      const radian = deg * Math.PI / 180;\n      const cosRadian = Math.cos(radian);\n      const sinRadian = Math.sin(radian);\n      translateX = translateX * cosRadian + translateY * sinRadian;\n      translateY = translateY * cosRadian - offsetX / scale * sinRadian;\n      const style = {\n        transform: `scale(${scale}) rotate(${deg}deg) translate(${translateX}px, ${translateY}px)`,\n        transition: enableTransition ? \"transform .3s\" : \"\"\n      };\n      if (mode.value.name === modes.CONTAIN.name) {\n        style.maxWidth = style.maxHeight = \"100%\";\n      }\n      return style;\n    });\n    const progress = computed(() => `${activeIndex.value + 1} / ${props.urlList.length}`);\n    function hide() {\n      unregisterEventListener();\n      emit(\"close\");\n    }\n    function registerEventListener() {\n      const keydownHandler = throttle(e => {\n        switch (e.code) {\n          case EVENT_CODE.esc:\n            props.closeOnPressEscape && hide();\n            break;\n          case EVENT_CODE.space:\n            toggleMode();\n            break;\n          case EVENT_CODE.left:\n            prev();\n            break;\n          case EVENT_CODE.up:\n            handleActions(\"zoomIn\");\n            break;\n          case EVENT_CODE.right:\n            next();\n            break;\n          case EVENT_CODE.down:\n            handleActions(\"zoomOut\");\n            break;\n        }\n      });\n      const mousewheelHandler = throttle(e => {\n        const delta = e.deltaY || e.deltaX;\n        handleActions(delta < 0 ? \"zoomIn\" : \"zoomOut\", {\n          zoomRate: props.zoomRate,\n          enableTransition: false\n        });\n      });\n      scopeEventListener.run(() => {\n        useEventListener(document, \"keydown\", keydownHandler);\n        useEventListener(document, \"wheel\", mousewheelHandler);\n      });\n    }\n    function unregisterEventListener() {\n      scopeEventListener.stop();\n    }\n    function handleImgLoad() {\n      loading.value = false;\n    }\n    function handleImgError(e) {\n      loading.value = false;\n      e.target.alt = t(\"el.image.error\");\n    }\n    function handleMouseDown(e) {\n      if (loading.value || e.button !== 0 || !wrapper.value) return;\n      transform.value.enableTransition = false;\n      const {\n        offsetX,\n        offsetY\n      } = transform.value;\n      const startX = e.pageX;\n      const startY = e.pageY;\n      const dragHandler = throttle(ev => {\n        transform.value = {\n          ...transform.value,\n          offsetX: offsetX + ev.pageX - startX,\n          offsetY: offsetY + ev.pageY - startY\n        };\n      });\n      const removeMousemove = useEventListener(document, \"mousemove\", dragHandler);\n      useEventListener(document, \"mouseup\", () => {\n        removeMousemove();\n      });\n      e.preventDefault();\n    }\n    function reset() {\n      transform.value = {\n        scale: 1,\n        deg: 0,\n        offsetX: 0,\n        offsetY: 0,\n        enableTransition: false\n      };\n    }\n    function toggleMode() {\n      if (loading.value) return;\n      const modeNames = keysOf(modes);\n      const modeValues = Object.values(modes);\n      const currentMode = mode.value.name;\n      const index = modeValues.findIndex(i => i.name === currentMode);\n      const nextIndex = (index + 1) % modeNames.length;\n      mode.value = modes[modeNames[nextIndex]];\n      reset();\n    }\n    function setActiveItem(index) {\n      const len = props.urlList.length;\n      activeIndex.value = (index + len) % len;\n    }\n    function prev() {\n      if (isFirst.value && !props.infinite) return;\n      setActiveItem(activeIndex.value - 1);\n    }\n    function next() {\n      if (isLast.value && !props.infinite) return;\n      setActiveItem(activeIndex.value + 1);\n    }\n    function handleActions(action, options = {}) {\n      if (loading.value) return;\n      const {\n        minScale,\n        maxScale\n      } = props;\n      const {\n        zoomRate,\n        rotateDeg,\n        enableTransition\n      } = {\n        zoomRate: props.zoomRate,\n        rotateDeg: 90,\n        enableTransition: true,\n        ...options\n      };\n      switch (action) {\n        case \"zoomOut\":\n          if (transform.value.scale > minScale) {\n            transform.value.scale = Number.parseFloat((transform.value.scale / zoomRate).toFixed(3));\n          }\n          break;\n        case \"zoomIn\":\n          if (transform.value.scale < maxScale) {\n            transform.value.scale = Number.parseFloat((transform.value.scale * zoomRate).toFixed(3));\n          }\n          break;\n        case \"clockwise\":\n          transform.value.deg += rotateDeg;\n          emit(\"rotate\", transform.value.deg);\n          break;\n        case \"anticlockwise\":\n          transform.value.deg -= rotateDeg;\n          emit(\"rotate\", transform.value.deg);\n          break;\n      }\n      transform.value.enableTransition = enableTransition;\n    }\n    function onFocusoutPrevented(event) {\n      var _a2;\n      if (((_a2 = event.detail) == null ? void 0 : _a2.focusReason) === \"pointer\") {\n        event.preventDefault();\n      }\n    }\n    function onCloseRequested() {\n      if (props.closeOnPressEscape) {\n        hide();\n      }\n    }\n    watch(currentImg, () => {\n      nextTick(() => {\n        const $img = imgRefs.value[0];\n        if (!($img == null ? void 0 : $img.complete)) {\n          loading.value = true;\n        }\n      });\n    });\n    watch(activeIndex, val => {\n      reset();\n      emit(\"switch\", val);\n    });\n    onMounted(() => {\n      registerEventListener();\n    });\n    expose({\n      setActiveItem\n    });\n    return (_ctx, _cache) => {\n      return openBlock(), createBlock(unref(ElTeleport), {\n        to: \"body\",\n        disabled: !_ctx.teleported\n      }, {\n        default: withCtx(() => [createVNode(Transition, {\n          name: \"viewer-fade\",\n          appear: \"\"\n        }, {\n          default: withCtx(() => [createElementVNode(\"div\", {\n            ref_key: \"wrapper\",\n            ref: wrapper,\n            tabindex: -1,\n            class: normalizeClass(unref(ns).e(\"wrapper\")),\n            style: normalizeStyle({\n              zIndex: zIndex.value\n            })\n          }, [createVNode(unref(ElFocusTrap), {\n            loop: \"\",\n            trapped: \"\",\n            \"focus-trap-el\": wrapper.value,\n            \"focus-start-el\": \"container\",\n            onFocusoutPrevented,\n            onReleaseRequested: onCloseRequested\n          }, {\n            default: withCtx(() => [createElementVNode(\"div\", {\n              class: normalizeClass(unref(ns).e(\"mask\")),\n              onClick: withModifiers($event => _ctx.hideOnClickModal && hide(), [\"self\"])\n            }, null, 10, [\"onClick\"]), createCommentVNode(\" CLOSE \"), createElementVNode(\"span\", {\n              class: normalizeClass([unref(ns).e(\"btn\"), unref(ns).e(\"close\")]),\n              onClick: hide\n            }, [createVNode(unref(ElIcon), null, {\n              default: withCtx(() => [createVNode(unref(Close))]),\n              _: 1\n            })], 2), createCommentVNode(\" ARROW \"), !unref(isSingle) ? (openBlock(), createElementBlock(Fragment, {\n              key: 0\n            }, [createElementVNode(\"span\", {\n              class: normalizeClass(unref(arrowPrevKls)),\n              onClick: prev\n            }, [createVNode(unref(ElIcon), null, {\n              default: withCtx(() => [createVNode(unref(ArrowLeft))]),\n              _: 1\n            })], 2), createElementVNode(\"span\", {\n              class: normalizeClass(unref(arrowNextKls)),\n              onClick: next\n            }, [createVNode(unref(ElIcon), null, {\n              default: withCtx(() => [createVNode(unref(ArrowRight))]),\n              _: 1\n            })], 2)], 64)) : createCommentVNode(\"v-if\", true), _ctx.showProgress ? (openBlock(), createElementBlock(\"div\", {\n              key: 1,\n              class: normalizeClass([unref(ns).e(\"btn\"), unref(ns).e(\"progress\")])\n            }, [renderSlot(_ctx.$slots, \"progress\", {\n              activeIndex: activeIndex.value,\n              total: _ctx.urlList.length\n            }, () => [createTextVNode(toDisplayString(unref(progress)), 1)])], 2)) : createCommentVNode(\"v-if\", true), createCommentVNode(\" ACTIONS \"), createElementVNode(\"div\", {\n              class: normalizeClass([unref(ns).e(\"btn\"), unref(ns).e(\"actions\")])\n            }, [createElementVNode(\"div\", {\n              class: normalizeClass(unref(ns).e(\"actions__inner\"))\n            }, [renderSlot(_ctx.$slots, \"toolbar\", {\n              actions: handleActions,\n              prev,\n              next,\n              reset: toggleMode,\n              activeIndex: activeIndex.value\n            }, () => [createVNode(unref(ElIcon), {\n              onClick: $event => handleActions(\"zoomOut\")\n            }, {\n              default: withCtx(() => [createVNode(unref(ZoomOut))]),\n              _: 1\n            }, 8, [\"onClick\"]), createVNode(unref(ElIcon), {\n              onClick: $event => handleActions(\"zoomIn\")\n            }, {\n              default: withCtx(() => [createVNode(unref(ZoomIn))]),\n              _: 1\n            }, 8, [\"onClick\"]), createElementVNode(\"i\", {\n              class: normalizeClass(unref(ns).e(\"actions__divider\"))\n            }, null, 2), createVNode(unref(ElIcon), {\n              onClick: toggleMode\n            }, {\n              default: withCtx(() => [(openBlock(), createBlock(resolveDynamicComponent(unref(mode).icon)))]),\n              _: 1\n            }), createElementVNode(\"i\", {\n              class: normalizeClass(unref(ns).e(\"actions__divider\"))\n            }, null, 2), createVNode(unref(ElIcon), {\n              onClick: $event => handleActions(\"anticlockwise\")\n            }, {\n              default: withCtx(() => [createVNode(unref(RefreshLeft))]),\n              _: 1\n            }, 8, [\"onClick\"]), createVNode(unref(ElIcon), {\n              onClick: $event => handleActions(\"clockwise\")\n            }, {\n              default: withCtx(() => [createVNode(unref(RefreshRight))]),\n              _: 1\n            }, 8, [\"onClick\"])])], 2)], 2), createCommentVNode(\" CANVAS \"), createElementVNode(\"div\", {\n              class: normalizeClass(unref(ns).e(\"canvas\"))\n            }, [(openBlock(true), createElementBlock(Fragment, null, renderList(_ctx.urlList, (url, i) => {\n              return withDirectives((openBlock(), createElementBlock(\"img\", {\n                ref_for: true,\n                ref: el => imgRefs.value[i] = el,\n                key: url,\n                src: url,\n                style: normalizeStyle(unref(imgStyle)),\n                class: normalizeClass(unref(ns).e(\"img\")),\n                crossorigin: _ctx.crossorigin,\n                onLoad: handleImgLoad,\n                onError: handleImgError,\n                onMousedown: handleMouseDown\n              }, null, 46, [\"src\", \"crossorigin\"])), [[vShow, i === activeIndex.value]]);\n            }), 128))], 2), renderSlot(_ctx.$slots, \"default\")]),\n            _: 3\n          }, 8, [\"focus-trap-el\"])], 6)]),\n          _: 3\n        })]),\n        _: 3\n      }, 8, [\"disabled\"]);\n    };\n  }\n});\nvar ImageViewer = /* @__PURE__ */_export_sfc(_sfc_main, [[\"__file\", \"image-viewer.vue\"]]);\nexport { ImageViewer as default };","map":{"version":3,"names":["name","props","__props","modes","CONTAIN","icon","markRaw","FullScreen","ORIGINAL","ScaleToOriginal","t","useLocale","ns","useNamespace","nextZIndex","useZIndex","wrapper","ref","imgRefs","scopeEventListener","effectScope","loading","activeIndex","initialIndex","mode","shallowRef","transform","scale","deg","offsetX","offsetY","enableTransition","zIndex","_a","isSingle","computed","urlList","length","isFirst","value","isLast","currentImg","arrowPrevKls","e","is","infinite","arrowNextKls","imgStyle","translateX","translateY","radian","Math","PI","cosRadian","cos","sinRadian","sin","style","transition","maxWidth","maxHeight","progress","hide","unregisterEventListener","emit","registerEventListener","keydownHandler","throttle","code","EVENT_CODE","esc","closeOnPressEscape","space","toggleMode","left","prev","up","handleActions","right","next","down","mousewheelHandler","delta","deltaY","deltaX","zoomRate","run","useEventListener","document","stop","handleImgLoad","handleImgError","target","alt","handleMouseDown","button","startX","pageX","startY","pageY","dragHandler","ev","removeMousemove","preventDefault","reset","modeNames","keysOf","modeValues","Object","values","currentMode","index","findIndex","i","nextIndex","setActiveItem","len","action","options","minScale","maxScale","rotateDeg","Number","parseFloat","toFixed","onFocusoutPrevented","event","_a2","detail","focusReason","onCloseRequested","watch","nextTick","$img","complete","val","onMounted","expose","_ctx","_cache","openBlock","createBlock","unref","ElTeleport"],"sources":["../../../../../../packages/components/image-viewer/src/image-viewer.vue"],"sourcesContent":["<template>\n  <el-teleport to=\"body\" :disabled=\"!teleported\">\n    <transition name=\"viewer-fade\" appear>\n      <div\n        ref=\"wrapper\"\n        :tabindex=\"-1\"\n        :class=\"ns.e('wrapper')\"\n        :style=\"{ zIndex }\"\n      >\n        <el-focus-trap\n          loop\n          trapped\n          :focus-trap-el=\"wrapper\"\n          focus-start-el=\"container\"\n          @focusout-prevented=\"onFocusoutPrevented\"\n          @release-requested=\"onCloseRequested\"\n        >\n          <div :class=\"ns.e('mask')\" @click.self=\"hideOnClickModal && hide()\" />\n\n          <!-- CLOSE -->\n          <span :class=\"[ns.e('btn'), ns.e('close')]\" @click=\"hide\">\n            <el-icon>\n              <Close />\n            </el-icon>\n          </span>\n\n          <!-- ARROW -->\n          <template v-if=\"!isSingle\">\n            <span :class=\"arrowPrevKls\" @click=\"prev\">\n              <el-icon>\n                <ArrowLeft />\n              </el-icon>\n            </span>\n            <span :class=\"arrowNextKls\" @click=\"next\">\n              <el-icon>\n                <ArrowRight />\n              </el-icon>\n            </span>\n          </template>\n          <div v-if=\"showProgress\" :class=\"[ns.e('btn'), ns.e('progress')]\">\n            <slot\n              name=\"progress\"\n              :active-index=\"activeIndex\"\n              :total=\"urlList.length\"\n            >\n              {{ progress }}\n            </slot>\n          </div>\n          <!-- ACTIONS -->\n          <div :class=\"[ns.e('btn'), ns.e('actions')]\">\n            <div :class=\"ns.e('actions__inner')\">\n              <slot\n                name=\"toolbar\"\n                :actions=\"handleActions\"\n                :prev=\"prev\"\n                :next=\"next\"\n                :reset=\"toggleMode\"\n                :active-index=\"activeIndex\"\n              >\n                <el-icon @click=\"handleActions('zoomOut')\">\n                  <ZoomOut />\n                </el-icon>\n                <el-icon @click=\"handleActions('zoomIn')\">\n                  <ZoomIn />\n                </el-icon>\n                <i :class=\"ns.e('actions__divider')\" />\n                <el-icon @click=\"toggleMode\">\n                  <component :is=\"mode.icon\" />\n                </el-icon>\n                <i :class=\"ns.e('actions__divider')\" />\n                <el-icon @click=\"handleActions('anticlockwise')\">\n                  <RefreshLeft />\n                </el-icon>\n                <el-icon @click=\"handleActions('clockwise')\">\n                  <RefreshRight />\n                </el-icon>\n              </slot>\n            </div>\n          </div>\n          <!-- CANVAS -->\n          <div :class=\"ns.e('canvas')\">\n            <img\n              v-for=\"(url, i) in urlList\"\n              v-show=\"i === activeIndex\"\n              :ref=\"(el) => (imgRefs[i] = el as HTMLImageElement)\"\n              :key=\"url\"\n              :src=\"url\"\n              :style=\"imgStyle\"\n              :class=\"ns.e('img')\"\n              :crossorigin=\"crossorigin\"\n              @load=\"handleImgLoad\"\n              @error=\"handleImgError\"\n              @mousedown=\"handleMouseDown\"\n            />\n          </div>\n          <slot />\n        </el-focus-trap>\n      </div>\n    </transition>\n  </el-teleport>\n</template>\n\n<script lang=\"ts\" setup>\nimport {\n  computed,\n  effectScope,\n  markRaw,\n  nextTick,\n  onMounted,\n  ref,\n  shallowRef,\n  watch,\n} from 'vue'\nimport { useEventListener } from '@vueuse/core'\nimport { throttle } from 'lodash-unified'\nimport { useLocale, useNamespace, useZIndex } from '@element-plus/hooks'\nimport { EVENT_CODE } from '@element-plus/constants'\nimport { keysOf } from '@element-plus/utils'\nimport ElFocusTrap from '@element-plus/components/focus-trap'\nimport ElTeleport from '@element-plus/components/teleport'\nimport ElIcon from '@element-plus/components/icon'\nimport {\n  ArrowLeft,\n  ArrowRight,\n  Close,\n  FullScreen,\n  RefreshLeft,\n  RefreshRight,\n  ScaleToOriginal,\n  ZoomIn,\n  ZoomOut,\n} from '@element-plus/icons-vue'\nimport { imageViewerEmits, imageViewerProps } from './image-viewer'\n\nimport type { CSSProperties } from 'vue'\nimport type { ImageViewerAction, ImageViewerMode } from './image-viewer'\n\nconst modes: Record<'CONTAIN' | 'ORIGINAL', ImageViewerMode> = {\n  CONTAIN: {\n    name: 'contain',\n    icon: markRaw(FullScreen),\n  },\n  ORIGINAL: {\n    name: 'original',\n    icon: markRaw(ScaleToOriginal),\n  },\n}\n\ndefineOptions({\n  name: 'ElImageViewer',\n})\n\nconst props = defineProps(imageViewerProps)\nconst emit = defineEmits(imageViewerEmits)\n\nconst { t } = useLocale()\nconst ns = useNamespace('image-viewer')\nconst { nextZIndex } = useZIndex()\nconst wrapper = ref<HTMLDivElement>()\nconst imgRefs = ref<HTMLImageElement[]>([])\n\nconst scopeEventListener = effectScope()\n\nconst loading = ref(true)\nconst activeIndex = ref(props.initialIndex)\nconst mode = shallowRef<ImageViewerMode>(modes.CONTAIN)\nconst transform = ref({\n  scale: 1,\n  deg: 0,\n  offsetX: 0,\n  offsetY: 0,\n  enableTransition: false,\n})\nconst zIndex = ref(props.zIndex ?? nextZIndex())\n\nconst isSingle = computed(() => {\n  const { urlList } = props\n  return urlList.length <= 1\n})\n\nconst isFirst = computed(() => activeIndex.value === 0)\n\nconst isLast = computed(() => activeIndex.value === props.urlList.length - 1)\n\nconst currentImg = computed(() => props.urlList[activeIndex.value])\n\nconst arrowPrevKls = computed(() => [\n  ns.e('btn'),\n  ns.e('prev'),\n  ns.is('disabled', !props.infinite && isFirst.value),\n])\n\nconst arrowNextKls = computed(() => [\n  ns.e('btn'),\n  ns.e('next'),\n  ns.is('disabled', !props.infinite && isLast.value),\n])\n\nconst imgStyle = computed(() => {\n  const { scale, deg, offsetX, offsetY, enableTransition } = transform.value\n  let translateX = offsetX / scale\n  let translateY = offsetY / scale\n\n  const radian = (deg * Math.PI) / 180\n  const cosRadian = Math.cos(radian)\n  const sinRadian = Math.sin(radian)\n  translateX = translateX * cosRadian + translateY * sinRadian\n  translateY = translateY * cosRadian - (offsetX / scale) * sinRadian\n\n  const style: CSSProperties = {\n    transform: `scale(${scale}) rotate(${deg}deg) translate(${translateX}px, ${translateY}px)`,\n    transition: enableTransition ? 'transform .3s' : '',\n  }\n  if (mode.value.name === modes.CONTAIN.name) {\n    style.maxWidth = style.maxHeight = '100%'\n  }\n  return style\n})\n\nconst progress = computed(\n  () => `${activeIndex.value + 1} / ${props.urlList.length}`\n)\n\nfunction hide() {\n  unregisterEventListener()\n  emit('close')\n}\n\nfunction registerEventListener() {\n  const keydownHandler = throttle((e: KeyboardEvent) => {\n    switch (e.code) {\n      // ESC\n      case EVENT_CODE.esc:\n        props.closeOnPressEscape && hide()\n        break\n      // SPACE\n      case EVENT_CODE.space:\n        toggleMode()\n        break\n      // LEFT_ARROW\n      case EVENT_CODE.left:\n        prev()\n        break\n      // UP_ARROW\n      case EVENT_CODE.up:\n        handleActions('zoomIn')\n        break\n      // RIGHT_ARROW\n      case EVENT_CODE.right:\n        next()\n        break\n      // DOWN_ARROW\n      case EVENT_CODE.down:\n        handleActions('zoomOut')\n        break\n    }\n  })\n  const mousewheelHandler = throttle((e: WheelEvent) => {\n    const delta = e.deltaY || e.deltaX\n    handleActions(delta < 0 ? 'zoomIn' : 'zoomOut', {\n      zoomRate: props.zoomRate,\n      enableTransition: false,\n    })\n  })\n\n  scopeEventListener.run(() => {\n    useEventListener(document, 'keydown', keydownHandler)\n    useEventListener(document, 'wheel', mousewheelHandler)\n  })\n}\n\nfunction unregisterEventListener() {\n  scopeEventListener.stop()\n}\n\nfunction handleImgLoad() {\n  loading.value = false\n}\n\nfunction handleImgError(e: Event) {\n  loading.value = false\n  ;(e.target as HTMLImageElement).alt = t('el.image.error')\n}\n\nfunction handleMouseDown(e: MouseEvent) {\n  if (loading.value || e.button !== 0 || !wrapper.value) return\n  transform.value.enableTransition = false\n\n  const { offsetX, offsetY } = transform.value\n  const startX = e.pageX\n  const startY = e.pageY\n\n  const dragHandler = throttle((ev: MouseEvent) => {\n    transform.value = {\n      ...transform.value,\n      offsetX: offsetX + ev.pageX - startX,\n      offsetY: offsetY + ev.pageY - startY,\n    }\n  })\n  const removeMousemove = useEventListener(document, 'mousemove', dragHandler)\n  useEventListener(document, 'mouseup', () => {\n    removeMousemove()\n  })\n\n  e.preventDefault()\n}\n\nfunction reset() {\n  transform.value = {\n    scale: 1,\n    deg: 0,\n    offsetX: 0,\n    offsetY: 0,\n    enableTransition: false,\n  }\n}\n\nfunction toggleMode() {\n  if (loading.value) return\n\n  const modeNames = keysOf(modes)\n  const modeValues = Object.values(modes)\n  const currentMode = mode.value.name\n  const index = modeValues.findIndex((i) => i.name === currentMode)\n  const nextIndex = (index + 1) % modeNames.length\n  mode.value = modes[modeNames[nextIndex]]\n  reset()\n}\n\nfunction setActiveItem(index: number) {\n  const len = props.urlList.length\n  activeIndex.value = (index + len) % len\n}\n\nfunction prev() {\n  if (isFirst.value && !props.infinite) return\n  setActiveItem(activeIndex.value - 1)\n}\n\nfunction next() {\n  if (isLast.value && !props.infinite) return\n  setActiveItem(activeIndex.value + 1)\n}\n\nfunction handleActions(action: ImageViewerAction, options = {}) {\n  if (loading.value) return\n  const { minScale, maxScale } = props\n  const { zoomRate, rotateDeg, enableTransition } = {\n    zoomRate: props.zoomRate,\n    rotateDeg: 90,\n    enableTransition: true,\n    ...options,\n  }\n  switch (action) {\n    case 'zoomOut':\n      if (transform.value.scale > minScale) {\n        transform.value.scale = Number.parseFloat(\n          (transform.value.scale / zoomRate).toFixed(3)\n        )\n      }\n      break\n    case 'zoomIn':\n      if (transform.value.scale < maxScale) {\n        transform.value.scale = Number.parseFloat(\n          (transform.value.scale * zoomRate).toFixed(3)\n        )\n      }\n      break\n    case 'clockwise':\n      transform.value.deg += rotateDeg\n      emit('rotate', transform.value.deg)\n      break\n    case 'anticlockwise':\n      transform.value.deg -= rotateDeg\n      emit('rotate', transform.value.deg)\n      break\n  }\n  transform.value.enableTransition = enableTransition\n}\n\nfunction onFocusoutPrevented(event: CustomEvent) {\n  if (event.detail?.focusReason === 'pointer') {\n    event.preventDefault()\n  }\n}\n\nfunction onCloseRequested() {\n  if (props.closeOnPressEscape) {\n    hide()\n  }\n}\n\nwatch(currentImg, () => {\n  nextTick(() => {\n    const $img = imgRefs.value[0]\n    if (!$img?.complete) {\n      loading.value = true\n    }\n  })\n})\n\nwatch(activeIndex, (val) => {\n  reset()\n  emit('switch', val)\n})\n\nonMounted(() => {\n  registerEventListener()\n})\n\ndefineExpose({\n  /**\n   * @description manually switch image\n   */\n  setActiveItem,\n})\n</script>\n"],"mappings":";;;;;;;;;;;;;;mCAoJc;EACZA,IAAM;AACR;;;;;;;;;;IAbA,MAAMC,KAAyD,GAAAC,OAAA;IAAA,MACpDC,KAAA;MAAAC,OACD;QACNJ,IAAA,EAAM,SAAkB;QAC1BK,IAAA,EAAAC,OAAA,CAAAC,UAAA;MAAA,CACU;MAAAC,QACF;QACNR,IAAA,EAAM,UAAuB;QAC/BK,IAAA,EAAAC,OAAA,CAAAG,eAAA;MAAA;IAUF,CAAM;IACA;MAAAC;IAAA,CAAK,GAAAC,SAAA,EAA2B;IAChC,MAAAC,EAAE,GAAWC,YAAI,CAAU;IACjC,MAAM;MAAAC;IAA8B,IAAAC,SAAA;IAC9B,MAAAC,OAAA,GAAUC,GAAwB,EAAC;IAEzC,MAAMC,OAAA,GAAAD,GAAA;IAEA,MAAAE,kBAAkB,GAAAC,WAAA;IAClB,MAAAC,OAAA,GAAAJ,GAAA,CAAc,IAAI;IAClB,MAAAK,WAAmC,GAAAL,GAAA,CAAAhB,KAAA,CAAMsB,YAAO;IACtD,MAAMC,IAAA,GAAAC,UAAgB,CAAAtB,KAAA,CAAAC,OAAA;IAAA,MACbsB,SAAA,GAAAT,GAAA;MACPU,KAAK;MACLC,GAAS;MACTC,OAAS;MACTC,OAAkB;MACnBC,gBAAA;IACD;IAEM,MAAAC,MAAA,GAAAf,GAAA,EAAAgB,EAAA,GAAAhC,KAA0B,CAAA+B,MAAA,YAAAC,EAAA,GAAAnB,UAAA;IACxB,MAAAoB,QAAA,GAAAC,QAAc;MACpB;QAAAC;MAAe,CAAU,GAAAnC,KAAA;MAC1B,OAAAmC,OAAA,CAAAC,MAAA;IAED;IAEM,MAAAC,OAAA,GAAAH,QAAkB,CAAM,MAAAb,WAAY,CAAAiB,KAAA,KAAgB;IAE1D,MAAMC,MAAA,GAAAL,QAAsB,OAAAb,WAAoB,CAAAiB,KAAA,KAAAtC,KAAA,CAAAmC,OAAiB,CAACC,MAAA;IAE5D,MAAAI,UAAA,GAAAN,QAAA,OAA8BlC,KAAA,CAAAmC,OAAA,CAAAd,WAAA,CAAAiB,KAAA;IAClC,MAAAG,YAAU,GAAAP,QAAA,QACVvB,EAAA,CAAG+B,CAAA,CAAE,KAAM,GACX/B,EAAA,CAAG+B,CAAG,UACP/B,EAAA,CAAAgC,EAAA,cAAA3C,KAAA,CAAA4C,QAAA,IAAAP,OAAA,CAAAC,KAAA,EAEK;IACJ,MAAAO,YAAU,GAAAX,QAAA,QACVvB,EAAA,CAAG+B,CAAA,CAAE,KAAM,GACX/B,EAAA,CAAG+B,CAAG,UACP/B,EAAA,CAAAgC,EAAA,cAAA3C,KAAA,CAAA4C,QAAA,IAAAL,MAAA,CAAAD,KAAA,EAEK;IACJ,MAAAQ,QAAe,GAAAZ,QAAA,OAAuB;MACtC;QAAAR,KAAA;QAAAC,GAA2B;QAAAC,OAAA;QAAAC,OAAA;QAAAC;MAAA,IAAAL,SAAA,CAAAa,KAAA;MAC3B,IAAIS,UAAA,GAAanB,OAAU,GAAAF,KAAA;MAErB,IAAAsB,UAAA,GAAgBnB,OAAA,GAAWH,KAAA;MAC3B,MAAAuB,MAAA,GAAAtB,GAAY,GAAKuB,IAAA,CAAAC,EAAU;MAC3B,MAAAC,SAAA,GAAYF,IAAK,CAAAG,GAAA,CAAIJ,MAAM;MACpB,MAAAK,SAAA,GAAAJ,IAAA,CAAAK,GAAa,CAAAN,MAAA;MACbF,UAAA,GAAAA,UAAA,GAAaK,SAAa,GAAAJ,UAAU,GAASM,SAAA;MAE1DN,UAA6B,GAAAA,UAAA,GAAAI,SAAA,GAAAxB,OAAA,GAAAF,KAAA,GAAA4B,SAAA;MAC3B,MAAAE,KAAA;QACA/B,SAAA,WAAYC,KAAA,YAAqCC,GAAA,kBAAAoB,UAAA,OAAAC,UAAA;QACnDS,UAAA,EAAA3B,gBAAA;MACA;MACQ,IAAAP,IAAA,CAAAe,KAAA,CAAAvC,IAAW,KAAAG,KAAkB,CAAAC,OAAA,CAAAJ,IAAA;QACrCyD,KAAA,CAAAE,QAAA,GAAAF,KAAA,CAAAG,SAAA;MACA;MACD,OAAAH,KAAA;IAED;IACE,MAAAI,QAAqB,GAAA1B,QAAA,OAAS,GAAMb,WAAA,CAAAiB,KAAc,GAAM,OAAAtC,KAAA,CAAAmC,OAAA,CAAAC,MAAA;IAC1D,SAAAyB,KAAA;MAEAC,uBAAgB;MACUC,IAAA;IACxB;IACF,SAAAC,sBAAA;MAEA,MAAAC,cAAiC,GAAAC,QAAA,CAAAxB,CAAA;QACzB,QAAAA,CAAA,CAAAyB,IAAA;UACJ,KAAAC,UAAgB,CAAAC,GAAA;YAAArE,KAEE,CAAAsE,kBAAA,IAAAT,IAAA;YACd;UACA,KAAAO,UAAA,CAAAG,KAAA;YAAAC,UAEc;YACH;UACX,KAAAJ,UAAA,CAAAK,IAAA;YAAAC,IAEc;YACT;UACL,KAAAN,UAAA,CAAAO,EAAA;YAAAC,aAEc;YACd;UACA,KAAAR,UAAA,CAAAS,KAAA;YAAAC,IAEc;YACT;UACL,KAAAV,UAAA,CAAAW,IAAA;YAAAH,aAEc;YACd;QACA;MAAA,CACJ;MACF,MAACI,iBAAA,GAAAd,QAAA,CAAAxB,CAAA;QACK,MAAAuC,KAAA,GAAAvC,CAAA,CAAAwC,MAAA,IAA6BxC,CAAA,CAAAyC,MAAC;QAC5BP,aAAA,CAAQK,KAAE,OAAU,QAAE;UACdG,QAAA,EAAApF,KAAA,CAAAoF,QAAY;UACxBtD,gBAAgB;QAAA,EAChB;MAAkB,EACpB;MACFZ,kBAAC,CAAAmE,GAAA;QAEDC,gBAAA,CAAmBC,QAAU,aAAAtB,cAAA;QACVqB,gBAAA,CAAAC,QAAA,EAAU,SAAAP,iBAAyB;MACpD,CAAiB;IAAoC;IAEzD,SAAAlB,wBAAA;MAEA5C,kBAAmC,CAAAsE,IAAA;IACjC;IACF,SAAAC,cAAA;MAEArE,OAAS,CAAgBkB,KAAA;IACvB;IACF,SAAAoD,eAAAhD,CAAA;MAEAtB,OAAS,CAAAkB,KAAA;MACPI,CAAA,CAAAiD,MAAQ,CAAQC,GAAA,GAAAnF,CAAA;IACf;IACH,SAAAoF,gBAAAnD,CAAA;MAEA,IAAAtB,OAAA,CAAAkB,KAAA,IAAAI,CAAA,CAAyBoD,MAAe,WAAA/E,OAAA,CAAAuB,KAAA,EACtC;MACAb,SAAA,CAAUa,KAAA,CAAMR,gBAAmB;MAEnC,MAAM;QAAEF,OAAA;QAASC;MAAQ,IAAIJ,SAAU,CAAAa,KAAA;MACvC,MAAMyD,MAAA,GAASrD,CAAE,CAAAsD,KAAA;MACjB,MAAMC,MAAA,GAASvD,CAAE,CAAAwD,KAAA;MAEX,MAAAC,WAAA,GAAcjC,QAAS,CAACkC,EAAmB;QAC/C3E,SAAA,CAAUa,KAAQ;UAChB,GAAGb,SAAU,CAAAa,KAAA;UACbV,OAAA,EAASA,OAAU,GAAAwE,EAAA,CAAGJ,KAAQ,GAAAD,MAAA;UAC9BlE,OAAA,EAASA,OAAU,GAAAuE,EAAA,CAAGF,KAAQ,GAAAD;QAAA,CAChC;MAAA,CACD;MACD,MAAMI,eAAkB,GAAAf,gBAAA,CAAiBC,QAAU,eAAaY,WAAW;MAC1Db,gBAAA,CAAAC,QAAA,EAAU,WAAW,MAAM;QAC1Bc,eAAA;MAAA,CACjB;MAED3D,CAAA,CAAE4D,cAAe;IAAA;IAGnB,SAASC,KAAQA,CAAA;MACf9E,SAAA,CAAUa,KAAQ;QAChBZ,KAAO;QACPC,GAAK;QACLC,OAAS;QACTC,OAAS;QACTC,gBAAkB;MAAA,CACpB;IAAA;IAGF,SAAS0C,UAAaA,CAAA;MACpB,IAAIpD,OAAA,CAAQkB,KAAO,EAEb;MACA,MAAAkE,SAAA,GAAAC,MAAoB,CAAAvG,KAAA;MACpB,MAAAwG,UAAA,GAAAC,MAAmB,CAAMC,MAAA,CAAA1G,KAAA;MAC/B,MAAM2G,WAAmB,GAAAtF,IAAA,CAAAe,KAAA,CAAAvC,IAAU;MAC7B,MAAA+G,KAAA,GAAAJ,UAAqB,CAAAK,SAAe,CAAAC,CAAA,IAAAA,CAAA,CAAAjH,IAAA,KAAA8G,WAAA;MAC1C,MAAaI,SAAA,IAAMH,KAAU,QAAAN,SAAU,CAAApE,MAAA;MACjCb,IAAA,CAAAe,KAAA,GAAApC,KAAA,CAAAsG,SAAA,CAAAS,SAAA;MACRV,KAAA;IAEA;IACQ,SAAAW,aAAoBA,CAAAJ,KAAA;MACd,MAAAK,GAAA,GAAAnH,KAAA,CAAAmC,OAAA,CAAAC,MAAwB;MACtCf,WAAA,CAAAiB,KAAA,IAAAwE,KAAA,GAAAK,GAAA,IAAAA,GAAA;IAEA;IACE,SAAYzC,KAAA;MACE,IAAArC,OAAA,CAAAC,KAAA,KAAAtC,KAAA,CAAA4C,QAAqB,EACrC;MAEAsE,aAAgB,CAAA7F,WAAA,CAAAiB,KAAA;IACd;IACc,SAAAwC,KAAA;MAChB,IAAAvC,MAAA,CAAAD,KAAA,KAAAtC,KAAA,CAAA4C,QAAA,EAEA;MACEsE,aAAmB,CAAA7F,WAAA,CAAAiB,KAAA;IACnB;IACA,SAAQsC,aAAqBA,CAAAwC,MAAA,EAAAC,OAAA;MAAqB,IAAAjG,OAAA,CACtCkB,KAAM,EAChB;MAAW,MACO;QAAAgF,QAAA;QAAAC;MAAA,IAAAvH,KAAA;MAAA,MACf;QAAAoF,QAAA;QAAAoC,SAAA;QAAA1F;MAAA;QACLsD,QAAA,EAAApF,KAAA,CAAAoF,QAAA;QACAoC,SAAgB;QACd1F,gBAAK;QACC,GAAAuF;MACF,CAAU;MAAqB,QAAAD,MAClB;QACb;UACF,IAAA3F,SAAA,CAAAa,KAAA,CAAAZ,KAAA,GAAA4F,QAAA;YACA7F,SAAA,CAAAa,KAAA,CAAAZ,KAAA,GAAA+F,MAAA,CAAAC,UAAA,EAAAjG,SAAA,CAAAa,KAAA,CAAAZ,KAAA,GAAA0D,QAAA,EAAAuC,OAAA;UAAA;UAEI;QACQ;UAAqB,IAAAlG,SAClB,CAAAa,KAAA,CAAAZ,KAAc,GAAA6F,QAAA;YAC3B9F,SAAA,CAAAa,KAAA,CAAAZ,KAAA,GAAA+F,MAAA,CAAAC,UAAA,EAAAjG,SAAA,CAAAa,KAAA,CAAAZ,KAAA,GAAA0D,QAAA,EAAAuC,OAAA;UAAA;UAEF;QACF,KAAK;UACHlG,SAAA,CAAUa,KAAA,CAAMX,GAAO,IAAA6F,SAAA;UAClBzD,IAAA,WAAUtC,SAAU,CAAAa,KAAA,CAAMX,GAAG;UAClC;QACF,KAAK;UACHF,SAAA,CAAUa,KAAA,CAAMX,GAAO,IAAA6F,SAAA;UAClBzD,IAAA,WAAUtC,SAAU,CAAAa,KAAA,CAAMX,GAAG;UAClC;MAAA;MAEJF,SAAA,CAAUa,KAAA,CAAMR,gBAAmB,GAAAA,gBAAA;IAAA;IAGrC,SAAS8F,oBAAoBC,KAAoB;MAC3C,IAAAC,GAAA;MACF,MAAAA,GAAqB,GAAAD,KAAA,CAAAE,MAAA,qBAAAD,GAAA,CAAAE,WAAA;QACvBH,KAAA,CAAAvB,cAAA;MAAA;IAGF;IACE,SAAA2B,gBAA8BA,CAAA;MACvB,IAAAjI,KAAA,CAAAsE,kBAAA;QACPT,IAAA;MAAA;IAGF;IACEqE,KAAA,CAAA1F,UAAe;MACP2F,QAAA,OAAO;QACT,MAAAC,IAAA,GAAiBnH,OAAA,CAAAqB,KAAA;QACnB,MAAA8F,IAAQ,IAAQ,gBAAAA,IAAA,CAAAC,QAAA;UAClBjH,OAAA,CAAAkB,KAAA;QAAA;MACD,CACF;IAED,CAAM;IACE4F,KAAA,CAAA7G,WAAA,EAAAiH,GAAA;MACN/B,KAAK;MACNxC,IAAA,WAAAuE,GAAA;IAED;IACwBC,SAAA;MACvBvE,qBAAA;IAED,CAAa;IAAAwE,MAAA;MAAAtB;IAAA;IAIX,QAAAuB,IAAA,EAAAC,MAAA;MACD,OAAAC,SAAA,IAAAC,WAAA,CAAAC,KAAA,CAAAC,UAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}